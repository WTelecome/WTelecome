<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kredit Hesablama</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="/manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; margin: 0; padding: 10px; background: #f5f5f5; color: #333; }
        body.dark-mode { background: #1a1a1a; color: #e0e0e0; }
        body.dark-mode .container { background: #2c2c2c; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5); }
        body.dark-mode select, body.dark-mode input { background: #3c3c3c; color: #e0e0e0; border: 1px solid #555; }
        body.dark-mode button { background: #d32f2f; }
        body.dark-mode button:hover { background: #b71c1c; }
        body.dark-mode .info { color: #bbb; }
        body.dark-mode .payment-plan th, body.dark-mode .payment-plan td { border: 1px solid #555; }
        body.dark-mode .details { color: #e0e0e0; }
        .container { background: #ffffff; padding: 15px; border-radius: 15px; box-shadow: 0 4px 16px rgba(147, 112, 219, 0.15); max-width: 100%; }
        .logo { margin-bottom: 10px; text-align: center; font-size: 24px; font-weight: 700; color: #8a2be2; }
        h2 { font-size: 22px; font-weight: 600; margin-bottom: 15px; text-align: center; color: #8a2be2; }
        h3 { font-size: 18px; margin-bottom: 10px; color: #666; }
        select, input, button { display: block; width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; font-size: 14px; }
        select, input { border: 1px solid #ddd; }
        .invalid-input { border: 2px solid #ff4040; }
        button { background: #8a2be2; color: #fff; border: none; cursor: pointer; transition: background 0.3s; }
        button:hover { background: #6a1bb2; }
        #themeToggle { background: #8a2be2; color: #fff; border: none; padding: 10px; border-radius: 8px; cursor: pointer; margin-bottom: 10px; }
        #themeToggle:hover { background: #6a1bb2; }
        .dual-container { display: flex; flex-wrap: wrap; gap: 20px; }
        .dual-section { flex: 1; min-width: 300px; }
        .info { font-size: 12px; color: #888; margin-bottom: 10px; }
        .credit-card-container { perspective: 1000px; margin-top: 20px; cursor: pointer; }
        .credit-card { width: 100%; height: 200px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; will-change: transform; }
        .credit-card.flipped { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 10px; padding: 15px; color: #fff; }
        .card-front { background: linear-gradient(135deg, #8a2be2, #4b0082); z-index: 2; }
        .card-back { background: linear-gradient(135deg, #6a1bb2, #4b0082); transform: rotateY(180deg); }
        .card-front.taksit, .card-back.taksit { background: linear-gradient(135deg, #d32f2f, #b71c1c); }
        .card-front.bank, .card-back.bank { background: linear-gradient(135deg, #4682b4, #1e90ff); }
        .card-front.abb, .card-back.abb { background: linear-gradient(135deg, #004d99, #0066cc); }
        .card-bank-name { font-size: 18px; font-weight: 600; margin-bottom: 10px; }
        .card-details { display: flex; flex-direction: column; gap: 8px; }
        .card-details div { font-size: 14px; }
        .payment-plan { margin-top: 10px; }
        .payment-plan table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .payment-plan th, .payment-plan td { padding: 5px; text-align: center; border: 1px solid #ddd; }
        .details { margin-top: 10px; font-size: 12px; color: #fff; }
        .details p { margin: 5px 0; }
        .comparison-panel { margin-top: 20px; display: none; }
        .share-buttons { margin-top: 15px; display: none; text-align: center; }
        .share-btn { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 15px; cursor: pointer; }
        .share-btn:hover { background: #45a049; }
        #shareModal { 
            display: none; 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); z-index: 1000; 
            justify-content: center; align-items: center;
        }
        .modal-content { 
            background: white; padding: 25px; border-radius: 12px; 
            text-align: center; max-width: 320px; width: 90%;
        }
        .modal-btn { 
            display: block; width: 100%; margin: 12px 0; padding: 12px; 
            border: none; border-radius: 8px; font-size: 16px; cursor: pointer; color: white;
        }
        .wa-btn { background: #25D366; }
        .ig-btn { background: #E1306C; }
        .close-btn { background: #888; margin-top: 15px; }
        @media (max-width: 768px) {
            .dual-container { flex-direction: column; }
            .logo { font-size: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">WTelecome</div>
        <select id="language" onchange="updateLanguage()">
            <option value="az">Azərbaycan</option>
            <option value="en">English</option>
            <option value="ru">Русский</option>
        </select>
        <button id="themeToggle" aria-label="Rejimi dəyişdir" onclick="toggleTheme()">Tünd Rejim</button>
        <h2 id="title">Kredit Hesablama</h2>
        <div class="dual-container">
            <!-- Hesabat 1 -->
            <div class="dual-section">
                <h3>Hesabat 1</h3>
                <label for="seller1">Satıcı seçin:</label>
                <select id="seller1" onchange="updateMonths('1')">
                    <option value="taksit" selected>Taksit Kartları</option>
                    <option value="bank">Bank Daxili</option>
                    <option value="abb">ABB Daxili Kredit</option>
                </select>
                <label for="bank1">Bankı seçin:</label>
                <select id="bank1"></select>
                <label for="amount1">Məhsulun dəyəri (AZN):</label>
                <input type="number" id="amount1" placeholder="100 - 10000 AZN" min="100" max="10000" step="1">
                <label for="initialPayment1">İlkin ödəniş (AZN):</label>
                <input type="number" id="initialPayment1" placeholder="0 AZN" min="0" step="1">
                <div class="info">*Qalan məbləğə xidmət haqqı əlavə olunur</div>
                <label for="months1">Neçə ay:</label>
                <select id="months1"></select>
                <button onclick="calculatePayment('1')">Hesabla</button>
                <button onclick="toggleSecondScenario()">İkinci Ssenarini Aktivləşdir</button>

                <div class="credit-card-container" onclick="flipCard('1')">
                    <div class="credit-card" id="creditCard1">
                        <div class="card-front">
                            <div class="card-bank-name" id="cardBankName1">Bank</div>
                            <div class="card-details">
                                <div>Aylıq ödəniş: <span id="cardMonthly1">0.00 AZN</span></div>
                                <div>Faiz dərəcəsi: <span id="cardInterest1">0.00%</span></div>
                                <div>Ümumi məbləğ: <span id="cardTotal1">0.00 AZN</span></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="payment-plan" id="paymentPlanContent1"></div>
                        </div>
                    </div>
                </div>

                <div id="shareButtons1" class="share-buttons">
                    <button class="share-btn" onclick="openShareModal('1')">Paylaş</button>
                </div>
            </div>

            <!-- Hesabat 2 -->
            <div class="dual-section" id="secondScenario" style="display: none;">
                <h3>Hesabat 2</h3>
                <label for="seller2">Satıcı seçin:</label>
                <select id="seller2" onchange="updateMonths('2')">
                    <option value="taksit" selected>Taksit Kartları</option>
                    <option value="bank">Bank Daxili</option>
                    <option value="abb">ABB Daxili Kredit</option>
                </select>
                <label for="bank2">Bankı seçin:</label>
                <select id="bank2"></select>
                <label for="amount2">Məhsulun dəyəri (AZN):</label>
                <input type="number" id="amount2" placeholder="100 - 10000 AZN" min="100" max="10000" step="1">
                <label for="initialPayment2">İlkin ödəniş (AZN):</label>
                <input type="number" id="initialPayment2" placeholder="0 AZN" min="0" step="1">
                <div class="info">*Qalan məbləğə xidmət haqqı əlavə olunur</div>
                <label for="months2">Neçə ay:</label>
                <select id="months2"></select>
                <button onclick="calculatePayment('2')">Hesabla</button>

                <div class="credit-card-container" onclick="flipCard('2')">
                    <div class="credit-card" id="creditCard2">
                        <div class="card-front">
                            <div class="card-bank-name" id="cardBankName2">Bank</div>
                            <div class="card-details">
                                <div>Aylıq ödəniş: <span id="cardMonthly2">0.00 AZN</span></div>
                                <div>Faiz dərəcəsi: <span id="cardInterest2">0.00%</span></div>
                                <div>Ümumi məbləğ: <span id="cardTotal2">0.00 AZN</span></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="payment-plan" id="paymentPlanContent2"></div>
                        </div>
                    </div>
                </div>

                <div id="shareButtons2" class="share-buttons">
                    <button class="share-btn" onclick="openShareModal('2')">Paylaş</button>
                </div>
            </div>
        </div>

        <!-- Paylaşım Modal -->
        <div id="shareModal">
            <div class="modal-content">
                <h3>Mesajı harada paylaşmaq istəyirsiniz?</h3>
                <button class="modal-btn wa-btn" onclick="shareToWhatsApp(currentSection)">WhatsApp</button>
                <button class="modal-btn ig-btn" onclick="shareToInstagram(currentSection)">Instagram</button>
                <button class="modal-btn close-btn" onclick="closeShareModal()">Bağla</button>
            </div>
        </div>
    </div>

    <script>
        let currentSection = '1';

        function openShareModal(section) {
            currentSection = section;
            document.getElementById('shareModal').style.display = 'flex';
        }

        function closeShareModal() {
            document.getElementById('shareModal').style.display = 'none';
        }

        // Qalan funksiyalar (updateMonths, getInterestRate, calculatePayment, flipCard, toggleSecondScenario və s.) əvvəlki kimi qalır

        function getShareMessage(section) {
            const bank = document.getElementById(`cardBankName${section}`).innerText;
            const monthly = document.getElementById(`cardMonthly${section}`).innerText;
            const total = document.getElementById(`cardTotal${section}`).innerText;
            const months = document.getElementById(`months${section}`).value;

            if (!monthly || monthly.includes("Xəta")) return null;

            return `Dəyərli müştəri,\n\n` +
                   `Məhsulun ümumi qiyməti: ${total}\n` +
                   `${months} aylıq taksit ilə\n` +
                   `Aylıq ödəniş: ${monthly}\n\n` +
                   `Hesablandı: ${bank}\n\n` +
                   `Təşəkkürlər! WTelecome`;
        }

        function shareToWhatsApp(section) {
            const message = getShareMessage(section);
            if (!message) {
                alert("Əvvəlcə hesablama edin!");
                closeShareModal();
                return;
            }
            const encoded = encodeURIComponent(message);
            window.open(`https://wa.me/?text=${encoded}`, '_blank');
            closeShareModal();
        }

        function shareToInstagram(section) {
            const message = getShareMessage(section);
            if (!message) {
                alert("Əvvəlcə hesablama edin!");
                closeShareModal();
                return;
            }

            navigator.clipboard.writeText(message).then(() => {
                alert("Mesaj kopyalandı!\nInstagram-da Story və ya Post-a yapışdırın.");
                window.open("instagram://", "_blank");
                if (navigator.share) {
                    navigator.share({ title: 'Kredit Hesablaması', text: message }).catch(() => {});
                }
            }).catch(() => {
                alert("Kopyalama uğursuz oldu:\n\n" + message);
            });
            closeShareModal();
        }

        // calculatePayment funksiyasında paylaş düyməsini göstərmək (əvvəlki kimi)
        // ... (hesablama sonunda)
        // const shareDiv = document.getElementById(`shareButtons${s}`);
        // if (shareDiv) shareDiv.style.display = monthlyEl.innerText.includes("Xəta") ? 'none' : 'block';

        // Qalan kod (updateMonths, calculatePayment və s.) əvvəlki yekun versiyadan kopyalayın
        // Burada tam kodu yerləşdirmək çox uzun olardı, ancaq yuxarıdakı modal + düymə hissəsini əlavə edin
    </script>
</body>
</html>
