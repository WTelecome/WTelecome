<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kredit Hesablama</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="/manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; margin: 0; padding: 10px; background: #f5f5f5; color: #333; }
        body.dark-mode { background: #1a1a1a; color: #e0e0e0; }
        body.dark-mode .container { background: #2c2c2c; box-shadow: 0 4px 16px rgba(0,0,0,0.5); }
        body.dark-mode select, body.dark-mode input { background: #3c3c3c; color: #e0e0e0; border: 1px solid #555; }
        body.dark-mode button { background: #d32f2f; }
        body.dark-mode button:hover { background: #b71c1c; }
        .container { background: #ffffff; padding: 15px; border-radius: 15px; box-shadow: 0 4px 16px rgba(147,112,219,0.15); max-width: 100%; }
        .logo { margin-bottom: 10px; text-align: center; font-size: 24px; font-weight: 700; color: #8a2be2; }
        h2 { font-size: 22px; font-weight: 600; margin-bottom: 15px; text-align: center; color: #8a2be2; }
        h3 { font-size: 18px; margin-bottom: 10px; color: #666; }
        select, input, button { display: block; width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; font-size: 14px; }
        select, input { border: 1px solid #ddd; }
        .invalid-input { border: 2px solid #ff4040; }
        button { background: #8a2be2; color: #fff; border: none; cursor: pointer; transition: background 0.3s; }
        button:hover { background: #6a1bb2; }
        #themeToggle { background: #8a2be2; color: #fff; border: none; padding: 10px; border-radius: 8px; cursor: pointer; margin-bottom: 10px; }
        .dual-container { display: flex; flex-wrap: wrap; gap: 20px; }
        .dual-section { flex: 1; min-width: 300px; }
        .info { font-size: 12px; color: #888; margin-bottom: 10px; }
        .credit-card-container { perspective: 1000px; margin-top: 20px; cursor: pointer; }
        .credit-card { width: 100%; height: 200px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; }
        .credit-card.flipped { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 10px; padding: 15px; color: #fff; }
        .card-front { background: linear-gradient(135deg, #8a2be2, #4b0082); z-index: 2; }
        .card-back { background: linear-gradient(135deg, #6a1bb2, #4b0082); transform: rotateY(180deg); }
        .card-front.taksit, .card-back.taksit { background: linear-gradient(135deg, #d32f2f, #b71c1c); }
        .card-front.bank, .card-back.bank { background: linear-gradient(135deg, #4682b4, #1e90ff); }
        .card-front.abb, .card-back.abb { background: linear-gradient(135deg, #004d99, #0066cc); }
        .card-bank-name { font-size: 18px; font-weight: 600; margin-bottom: 10px; }
        .share-buttons { margin-top: 15px; display: none; text-align: center; }
        .share-btn { background: #4CAF50; color: white; padding: 12px 24px; border: none; border-radius: 8px; font-size: 15px; cursor: pointer; }
        .share-btn:hover { background: #45a049; }
        #shareModal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-content { 
            background: white; padding: 25px; border-radius: 12px; text-align: center; 
            max-width: 340px; width: 90%; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .modal-btn { display: block; width: 100%; margin: 12px 0; padding: 12px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; color: white; }
        .wa-btn { background: #25D366; }
        .ig-btn { background: #E1306C; }
        .close-btn { background: #757575; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">WTelecome</div>
        <select id="language" onchange="updateLanguage()">
            <option value="az">Azərbaycan</option>
            <option value="en">English</option>
            <option value="ru">Русский</option>
        </select>
        <button id="themeToggle" onclick="toggleTheme()">Tünd Rejim</button>
        <h2>Kredit Hesablama</h2>

        <div class="dual-container">
            <!-- Hesabat 1 -->
            <div class="dual-section">
                <h3>Hesabat 1</h3>
                <label>Satıcı seçin:</label>
                <select id="seller1" onchange="updateMonths('1')">
                    <option value="taksit" selected>Taksit Kartları</option>
                    <option value="bank">Bank Daxili</option>
                    <option value="abb">ABB Daxili Kredit</option>
                </select>

                <label>Bankı seçin:</label>
                <select id="bank1" onchange="calculatePayment('1')"></select>

                <label>Məhsulun dəyəri (AZN):</label>
                <input type="number" id="amount1" min="100" max="10000" placeholder="100 - 10000">

                <label>İlkin ödəniş (AZN):</label>
                <input type="number" id="initialPayment1" min="0" placeholder="0">

                <div class="info">*Qalan məbləğə xidmət haqqı əlavə olunur</div>

                <label>Neçə ay:</label>
                <select id="months1" onchange="calculatePayment('1')"></select>

                <button onclick="calculatePayment('1')">Hesabla</button>
                <button onclick="toggleSecondScenario()">İkinci Ssenarini Aktivləşdir</button>

                <div class="credit-card-container" onclick="flipCard('1')">
                    <div class="credit-card" id="creditCard1">
                        <div class="card-front">
                            <div class="card-bank-name" id="cardBankName1">Bank</div>
                            <div class="card-details">
                                <div>Aylıq ödəniş: <span id="cardMonthly1">0.00 AZN</span></div>
                                <div>Faiz dərəcəsi: <span id="cardInterest1">0.00%</span></div>
                                <div>Ümumi məbləğ: <span id="cardTotal1">0.00 AZN</span></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="payment-plan" id="paymentPlanContent1"></div>
                        </div>
                    </div>
                </div>

                <div id="shareButtons1" class="share-buttons">
                    <button class="share-btn" onclick="openShareModal('1')">Paylaş</button>
                </div>
            </div>

            <!-- Hesabat 2 (əvvəlcə gizli) -->
            <div class="dual-section" id="secondScenario" style="display:none;">
                <h3>Hesabat 2</h3>
                <label>Satıcı seçin:</label>
                <select id="seller2" onchange="updateMonths('2')">
                    <option value="taksit" selected>Taksit Kartları</option>
                    <option value="bank">Bank Daxili</option>
                    <option value="abb">ABB Daxili Kredit</option>
                </select>

                <label>Bankı seçin:</label>
                <select id="bank2" onchange="calculatePayment('2')"></select>

                <label>Məhsulun dəyəri (AZN):</label>
                <input type="number" id="amount2" min="100" max="10000" placeholder="100 - 10000">

                <label>İlkin ödəniş (AZN):</label>
                <input type="number" id="initialPayment2" min="0" placeholder="0">

                <div class="info">*Qalan məbləğə xidmət haqqı əlavə olunur</div>

                <label>Neçə ay:</label>
                <select id="months2" onchange="calculatePayment('2')"></select>

                <button onclick="calculatePayment('2')">Hesabla</button>

                <div class="credit-card-container" onclick="flipCard('2')">
                    <div class="credit-card" id="creditCard2">
                        <div class="card-front">
                            <div class="card-bank-name" id="cardBankName2">Bank</div>
                            <div class="card-details">
                                <div>Aylıq ödəniş: <span id="cardMonthly2">0.00 AZN</span></div>
                                <div>Faiz dərəcəsi: <span id="cardInterest2">0.00%</span></div>
                                <div>Ümumi məbləğ: <span id="cardTotal2">0.00 AZN</span></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="payment-plan" id="paymentPlanContent2"></div>
                        </div>
                    </div>
                </div>

                <div id="shareButtons2" class="share-buttons">
                    <button class="share-btn" onclick="openShareModal('2')">Paylaş</button>
                </div>
            </div>
        </div>

        <!-- Paylaşım Modal -->
        <div id="shareModal">
            <div class="modal-content">
                <h3>Mesajı harada paylaşmaq istəyirsiniz?</h3>
                <button class="modal-btn wa-btn" onclick="shareToWhatsApp(currentSection)">WhatsApp</button>
                <button class="modal-btn ig-btn" onclick="shareToInstagram(currentSection)">Instagram</button>
                <button class="modal-btn close-btn" onclick="closeShareModal()">Bağla</button>
            </div>
        </div>
    </div>

    <script>
        let currentSection = '1';

        const bankNames = {
            "tamkart": "TamKart",
            "birkart": "Birkart",
            "leo": "Leo Bank",
            "bolkart": "Bolkart",
            "abb": "ABB Daxili Kredit"
        };

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            document.getElementById('themeToggle').innerText = document.body.classList.contains('dark-mode') ? 'Açıq Rejim' : 'Tünd Rejim';
        }

        function updateLanguage() {
            // Sadəcə başlıq üçün (əlavə tərcümələr əlavə edə bilərsiniz)
        }

        function updateMonths(section) {
            const seller = document.getElementById(`seller${section}`).value;
            const bankSelect = document.getElementById(`bank${section}`);
            const monthsSelect = document.getElementById(`months${section}`);

            bankSelect.innerHTML = "";
            monthsSelect.innerHTML = "";

            if (seller === "abb") {
                bankSelect.innerHTML = '<option value="abb" selected>ABB</option>';
                bankSelect.disabled = true;
                [1,2,3,6,9,12,18,24].forEach(m => {
                    monthsSelect.innerHTML += `<option value="${m}">${m} ay</option>`;
                });
            } else if (seller === "bank") {
                bankSelect.disabled = false;
                bankSelect.innerHTML = '<option value="resmi">Rəsmi</option><option value="qeyri-resmi">Qeyri-rəsmi</option>';
                [2,3,6,12,18,24,35].forEach(m => {
                    monthsSelect.innerHTML += `<option value="${m}">${m} ay</option>`;
                });
            } else { // taksit
                bankSelect.disabled = false;
                bankSelect.innerHTML = `
                    <option value="tamkart">TamKart</option>
                    <option value="birkart">Birkart</option>
                    <option value="leo">Leo Bank</option>
                    <option value="bolkart">Bolkart</option>
                `;
                [3,6,9,12,18,24].forEach(m => {
                    monthsSelect.innerHTML += `<option value="${m}">${m} ay</option>`;
                });
            }

            // Default seçimləri təyin et
            if (bankSelect.options.length > 0) bankSelect.selectedIndex = 0;
            if (monthsSelect.options.length > 0) monthsSelect.selectedIndex = 0;

            calculatePayment(section);
        }

        function getInterestRate(bank, months, seller) {
            const taksitRates = {
                "tamkart": {3:0.06,6:0.10,9:0.11,12:0.14,18:0.16,24:0.20},
                "birkart": {3:0.06,6:0.10,9:0.11,12:0.16,18:0.16,24:0.21},
                "leo":     {3:0.09,6:0.13,9:0.14,12:0.17,18:0.20,24:0.24},
                "bolkart": {3:0.09,6:0.13,9:0.14,12:0.17,18:0.20,24:0.24}
            };
            const bankRates = {
                "resmi":     {2:0.031,3:0.042,6:0.074,12:0.128,18:0.188,24:0.247,35:0.31},
                "qeyri-resmi":{2:0.036,3:0.048,6:0.082,12:0.147,18:0.206,24:0.26,35:0.354}
            };
            const abbRates = {1:0.05,2:0.07,3:0.08,6:0.11,9:0.16,12:0.18,18:0.26,24:0.35};

            if (seller === "abb") return abbRates[months] || 0;
            if (seller === "bank") return bankRates[bank]?.[months] || 0;
            return taksitRates[bank]?.[months] || 0;
        }

        function calculatePayment(section) {
            const seller = document.getElementById(`seller${section}`).value;
            const bankEl = document.getElementById(`bank${section}`);
            let bank = bankEl.value;

            // Taksitdə bank boş qalmamalı
            if (seller === "taksit" && !bank) {
                bank = "tamkart";
                bankEl.value = "tamkart";
            }

            const amount    = parseFloat(document.getElementById(`amount${section}`).value) || 0;
            const initial   = parseFloat(document.getElementById(`initialPayment${section}`).value) || 0;
            const months    = parseInt(document.getElementById(`months${section}`).value) || 0;

            const monthlyEl = document.getElementById(`cardMonthly${section}`);
            const interestEl= document.getElementById(`cardInterest${section}`);
            const totalEl   = document.getElementById(`cardTotal${section}`);
            const bankNameEl= document.getElementById(`cardBankName${section}`);
            const planEl    = document.getElementById(`paymentPlanContent${section}`);

            if (amount < 100 || amount > 10000 || initial > amount || months < 1) {
                monthlyEl.innerText = interestEl.innerText = totalEl.innerText = "Xəta";
                planEl.innerHTML = "<p style='color:red;'>Dəyərləri düzgün daxil edin</p>";
                document.getElementById(`shareButtons${section}`).style.display = "none";
                return;
            }

            const remaining = amount - initial;
            const serviceFee = (seller === "taksit" || seller === "abb") ? 20 : 0;
            const base = remaining + serviceFee;
            const rate = getInterestRate(bank, months, seller);
            const interest = base * rate;
            let total = Math.round((base + interest) / 10) * 10;
            const monthly = total / months;

            bankNameEl.innerText = bankNames[bank] || "Bank";
            monthlyEl.innerText = monthly.toFixed(2) + " AZN";
            interestEl.innerText = (rate * 100).toFixed(2) + "%";
            totalEl.innerText = total.toFixed(2) + " AZN";

            let html = `<table style="width:100%; border-collapse:collapse; font-size:12px;">
                <tr><th>Ay</th><th>Ödəniş</th><th>Qalıq</th></tr>`;
            let rest = total;
            for (let i = 1; i <= months; i++) {
                rest -= monthly;
                html += `<tr><td>${i}</td><td>${monthly.toFixed(2)}</td><td>${Math.max(0, rest).toFixed(2)}</td></tr>`;
            }
            html += `</table>
                <div style="margin-top:10px; font-size:12px; color:#fff;">
                    <p>Məbləğ: ${amount.toFixed(2)} AZN</p>
                    <p>Xidmət haqqı: ${serviceFee} AZN</p>
                    <p>Faiz: ${(rate*100).toFixed(2)}%</p>
                </div>`;
            planEl.innerHTML = html;

            document.getElementById(`shareButtons${section}`).style.display = "block";
        }

        function flipCard(section) {
            document.getElementById(`creditCard${section}`).classList.toggle('flipped');
        }

        function toggleSecondScenario() {
            const el = document.getElementById("secondScenario");
            el.style.display = el.style.display === "none" ? "block" : "none";
        }

        function openShareModal(section) {
            currentSection = section;
            document.getElementById("shareModal").style.display = "flex";
        }

        function closeShareModal() {
            document.getElementById("shareModal").style.display = "none";
        }

        function getShareMessage() {
            const sec = currentSection;
            const bank = document.getElementById(`cardBankName${sec}`).innerText;
            const monthly = document.getElementById(`cardMonthly${sec}`).innerText;
            const total = document.getElementById(`cardTotal${sec}`).innerText;
            const months = document.getElementById(`months${sec}`).value;

            return `Dəyərli müştəri,\n\nMəhsulun ümumi qiyməti: ${total}\n${months} aylıq taksit ilə\nAylıq ödəniş: ${monthly}\n\nHesablandı: ${bank}\n\nTəşəkkürlər! WTelecome`;
        }

        function shareToWhatsApp() {
            const msg = getShareMessage();
            if (!msg) return alert("Hesablamanı tamamlayın");
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
            closeShareModal();
        }

        function shareToInstagram() {
            const msg = getShareMessage();
            if (!msg) return alert("Hesablamanı tamamlayın");
            navigator.clipboard.writeText(msg).then(() => {
                alert("Mesaj kopyalandı!\nInstagram-da yapışdırın.");
                window.open("instagram://", "_blank");
            }).catch(() => alert("Kopyalama alınmadı:\n\n" + msg));
            closeShareModal();
        }

        // İlk yüklənmə
        window.addEventListener('load', () => {
            updateMonths('1');
            if (document.getElementById('seller2')) updateMonths('2');
            calculatePayment('1');
            // Event listener-lər inputlar üçün
            document.querySelectorAll('input[type="number"]').forEach(el => {
                el.addEventListener('input', () => {
                    const sec = el.id.slice(-1);
                    calculatePayment(sec);
                });
            });
        });
    </script>
</body>
</html>
