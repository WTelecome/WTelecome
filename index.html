<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kredit Hesablama</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="/manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; margin: 0; padding: 10px; background: #f5f5f5; color: #333; }
        body.dark-mode { background: #1a1a1a; color: #e0e0e0; }
        body.dark-mode .container { background: #2c2c2c; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5); }
        body.dark-mode select, body.dark-mode input { background: #3c3c3c; color: #e0e0e0; border: 1px solid #555; }
        body.dark-mode button { background: #d32f2f; }
        body.dark-mode button:hover { background: #b71c1c; }
        body.dark-mode .info { color: #bbb; }
        body.dark-mode .payment-plan th, body.dark-mode .payment-plan td { border: 1px solid #555; }
        body.dark-mode .details { color: #e0e0e0; }
        .container { background: #ffffff; padding: 15px; border-radius: 15px; box-shadow: 0 4px 16px rgba(147, 112, 219, 0.15); max-width: 100%; }
        .logo { margin-bottom: 10px; text-align: center; font-size: 24px; font-weight: 700; color: #8a2be2; }
        h2 { font-size: 22px; font-weight: 600; margin-bottom: 15px; text-align: center; color: #8a2be2; }
        h3 { font-size: 18px; margin-bottom: 10px; color: #666; }
        select, input, button { display: block; width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; font-size: 14px; }
        select, input { border: 1px solid #ddd; }
        .invalid-input { border: 2px solid #ff4040; }
        button { background: #8a2be2; color: #fff; border: none; cursor: pointer; transition: background 0.3s; margin-right: 8px; }
        button:hover { background: #6a1bb2; }
        #themeToggle { background: #8a2be2; color: #fff; border: none; padding: 10px; border-radius: 8px; cursor: pointer; margin-bottom: 10px; }
        #themeToggle:hover { background: #6a1bb2; }
        .dual-container { display: flex; flex-wrap: wrap; gap: 20px; }
        .dual-section { flex: 1; min-width: 300px; }
        .info { font-size: 12px; color: #888; margin-bottom: 10px; }
        .credit-card-container { perspective: 1000px; margin-top: 20px; cursor: pointer; }
        .credit-card { width: 100%; height: 200px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; will-change: transform; }
        .credit-card.flipped { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 10px; padding: 15px; color: #fff; }
        .card-front { background: linear-gradient(135deg, #8a2be2, #4b0082); z-index: 2; }
        .card-back { background: linear-gradient(135deg, #6a1bb2, #4b0082); transform: rotateY(180deg); }
        .card-front.taksit, .card-back.taksit { background: linear-gradient(135deg, #d32f2f, #b71c1c); }
        .card-front.bank, .card-back.bank { background: linear-gradient(135deg, #4682b4, #1e90ff); }
        .card-front.abb, .card-back.abb { background: linear-gradient(135deg, #004d99, #0066cc); }
        .card-bank-name { font-size: 18px; font-weight: 600; margin-bottom: 10px; }
        .card-details { display: flex; flex-direction: column; gap: 8px; }
        .card-details div { font-size: 14px; }
        .payment-plan { margin-top: 10px; }
        .payment-plan table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .payment-plan th, .payment-plan td { padding: 5px; text-align: center; border: 1px solid #ddd; }
        .details { margin-top: 10px; font-size: 12px; color: #fff; }
        .details p { margin: 5px 0; }
        .comparison-panel { margin-top: 20px; display: none; }
        .compare-btn, .dual-compare-btn { margin-top: 10px; }
        .share-buttons { margin-top: 15px; display: none; }
        .share-buttons button { padding: 10px 15px; font-size: 14px; border-radius: 8px; color: white; }
        @media (max-width: 768px) {
            .dual-container { flex-direction: column; }
            .logo { font-size: 20px; }
            .comparison-panel canvas { height: 300px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">WTelecome</div>
        <select id="language" onchange="updateLanguage()">
            <option value="az">Azərbaycan</option>
            <option value="en">English</option>
            <option value="ru">Русский</option>
        </select>
        <button id="themeToggle" aria-label="Rejimi dəyişdir" onclick="toggleTheme()">Tünd Rejim</button>
        <h2 id="title">Kredit Hesablama</h2>
        <div class="dual-container">
            <!-- Birinci Ssenari -->
            <div class="dual-section">
                <h3>Hesabat 1</h3>
                <label for="seller1" id="sellerLabel1">Satıcı seçin:</label>
                <select id="seller1" onchange="updateMonths('1')">
                    <option value="taksit" selected>Taksit Kartları</option>
                    <option value="bank">Bank Daxili</option>
                    <option value="abb">ABB Daxili Kredit</option>
                </select>
                <label for="bank1" id="bankLabel1">Bankı seçin:</label>
                <select id="bank1"></select>
                <label for="amount1" id="amountLabel1">Məhsulun dəyəri (AZN):</label>
                <input type="number" id="amount1" placeholder="100 - 10000 AZN" min="100" max="10000" step="1">
                <label for="initialPayment1" id="initialPaymentLabel1">İlkin ödəniş (AZN):</label>
                <input type="number" id="initialPayment1" placeholder="0 AZN" min="0" step="1">
                <div class="info" id="serviceFeeInfo1">*Qalan məbləğə xidmət haqqı əlavə olunur</div>
                <label for="months1" id="monthsLabel1">Neçə ay:</label>
                <select id="months1"></select>
                <button id="calculateBtn1" onclick="calculatePayment('1')">Hesabla</button>
                <button id="toggleScenarioBtn" onclick="toggleSecondScenario()">İkinci Ssenarini Aktivləşdir</button>

                <div class="credit-card-container" id="creditCardContainer1" onclick="flipCard('1')">
                    <div class="credit-card" id="creditCard1">
                        <div class="card-front">
                            <div class="card-bank-name" id="cardBankName1">Bank</div>
                            <div class="card-details">
                                <div>Aylıq ödəniş: <span id="cardMonthly1">0.00 AZN</span></div>
                                <div>Faiz dərəcəsi: <span id="cardInterest1">0.00%</span></div>
                                <div>Ümumi məbləğ: <span id="cardTotal1">0.00 AZN</span></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="payment-plan" id="paymentPlanContent1"></div>
                        </div>
                    </div>
                </div>

                <div id="shareButtons1" class="share-buttons">
                    <button onclick="shareToWhatsApp('1')" style="background: #25D366;">WhatsApp-a Göndər</button>
                    <button onclick="shareToInstagram('1')" style="background: #E1306C;">Instagram-a Göndər</button>
                </div>
            </div>

            <!-- İkinci Ssenari -->
            <div class="dual-section" id="secondScenario" style="display: none;">
                <h3>Hesabat 2</h3>
                <label for="seller2" id="sellerLabel2">Satıcı seçin:</label>
                <select id="seller2" onchange="updateMonths('2')">
                    <option value="taksit" selected>Taksit Kartları</option>
                    <option value="bank">Bank Daxili</option>
                    <option value="abb">ABB Daxili Kredit</option>
                </select>
                <label for="bank2" id="bankLabel2">Bankı seçin:</label>
                <select id="bank2"></select>
                <label for="amount2" id="amountLabel2">Məhsulun dəyəri (AZN):</label>
                <input type="number" id="amount2" placeholder="100 - 10000 AZN" min="100" max="10000" step="1">
                <label for="initialPayment2" id="initialPaymentLabel2">İlkin ödəniş (AZN):</label>
                <input type="number" id="initialPayment2" placeholder="0 AZN" min="0" step="1">
                <div class="info" id="serviceFeeInfo2">*Qalan məbləğə xidmət haqqı əlavə olunur</div>
                <label for="months2" id="monthsLabel2">Neçə ay:</label>
                <select id="months2"></select>
                <button id="calculateBtn2" onclick="calculatePayment('2')">Hesabla</button>

                <div class="credit-card-container" id="creditCardContainer2" onclick="flipCard('2')">
                    <div class="credit-card" id="creditCard2">
                        <div class="card-front">
                            <div class="card-bank-name" id="cardBankName2">Bank</div>
                            <div class="card-details">
                                <div>Aylıq ödəniş: <span id="cardMonthly2">0.00 AZN</span></div>
                                <div>Faiz dərəcəsi: <span id="cardInterest2">0.00%</span></div>
                                <div>Ümumi məbləğ: <span id="cardTotal2">0.00 AZN</span></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="payment-plan" id="paymentPlanContent2"></div>
                        </div>
                    </div>
                </div>

                <div id="shareButtons2" class="share-buttons">
                    <button onclick="shareToWhatsApp('2')" style="background: #25D366;">WhatsApp-a Göndər</button>
                    <button onclick="shareToInstagram('2')" style="background: #E1306C;">Instagram-a Göndər</button>
                </div>
            </div>
        </div>
        <button id="compareBtn" onclick="compareBanks()">Bütün bankları müqayisə et</button>
        <button class="dual-compare-btn" onclick="dualCompare()">İkiqat Müqayisə</button>
        <div class="comparison-panel" id="comparisonPanel">
            <canvas id="comparisonChart"></canvas>
        </div>
    </div>

    <script>
        const translations = {
            az: {
                title: "Kredit Hesablama",
                sellerLabel: "Satıcı seçin:",
                bankLabel: "Bankı seçin:",
                amountLabel: "Məhsulun dəyəri (AZN):",
                initialPaymentLabel: "İlkin ödəniş (AZN):",
                serviceFeeInfo: "*Qalan məbləğə xidmət haqqı əlavə olunur",
                monthsLabel: "Neçə ay:",
                calculateBtn: "Hesabla",
                compareBtn: "Bütün bankları müqayisə et",
                dualCompareBtn: "İkiqat Müqayisə",
                toggleScenarioBtn: "İkinci Ssenarini Aktivləşdir",
                paymentPlanHeaders: ["Ay", "Ödəniş", "Qalıq"],
                error: "Məbləğ 100-10000 AZN olmalıdır!",
                initialPaymentError: "İlkin ödəniş məbləğdən çox ola bilməz!",
                emptyInputError: "Bütün sahələri doldurun!",
            },
        };

        const bankNames = {
            "tamkart": "TamKart",
            "birkart": "Birkart",
            "leo": "Leo Bank",
            "bolkart": "Bolkart",
            "abb": "ABB Daxili Kredit"
        };

        function updateLanguage() {
            const lang = document.getElementById("language").value;
            localStorage.setItem('language', lang);
            document.getElementById("title").innerText = translations[lang]?.title || "Kredit Hesablama";
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('themeToggle').innerText = isDark ? 'Açıq Rejim' : 'Tünd Rejim';
        }

        function updateMonths(section) {
            const sellerSelect = document.getElementById(`seller${section}`);
            const bankSelect = document.getElementById(`bank${section}`);
            const monthsSelect = document.getElementById(`months${section}`);
            const seller = sellerSelect.value;

            bankSelect.innerHTML = "";
            monthsSelect.innerHTML = "";

            if (seller === "abb") {
                const opt = document.createElement("option");
                opt.value = "abb";
                opt.text = "ABB";
                opt.selected = true;
                bankSelect.appendChild(opt);
                bankSelect.disabled = true;

                ["1","2","3","6","9","12","18","24"].forEach(m => {
                    const opt = document.createElement("option");
                    opt.value = m;
                    opt.text = `${m} ay`;
                    monthsSelect.appendChild(opt);
                });
            } else if (seller === "bank") {
                bankSelect.disabled = false;
                ["resmi", "qeyri-resmi"].forEach(v => {
                    const opt = document.createElement("option");
                    opt.value = v;
                    opt.text = v === "resmi" ? "Rəsmi" : "Qeyri-rəsmi";
                    bankSelect.appendChild(opt);
                });
                ["2","3","6","12","18","24","35"].forEach(m => {
                    const opt = document.createElement("option");
                    opt.value = m;
                    opt.text = `${m} ay`;
                    monthsSelect.appendChild(opt);
                });
            } else { // taksit
                bankSelect.disabled = false;
                ["tamkart","birkart","leo","bolkart"].forEach(v => {
                    const opt = document.createElement("option");
                    opt.value = v;
                    opt.text = bankNames[v];
                    bankSelect.appendChild(opt);
                });

                if (bankSelect.options.length > 0) {
                    bankSelect.selectedIndex = 0;
                }

                ["3","6","9","12","18","24"].forEach(m => {
                    const opt = document.createElement("option");
                    opt.value = m;
                    opt.text = `${m} ay`;
                    monthsSelect.appendChild(opt);
                });

                if (monthsSelect.options.length > 0) {
                    monthsSelect.selectedIndex = 0;
                }
            }

            calculatePayment(section);
        }

        function getInterestRate(bank, months, seller) {
            const taksitRates = {
                "tamkart": { "3": 0.06, "6": 0.10, "9": 0.11, "12": 0.14, "18": 0.16, "24": 0.20 },
                "birkart": { "3": 0.06, "6": 0.10, "9": 0.11, "12": 0.16, "18": 0.16, "24": 0.21 },
                "leo": { "3": 0.09, "6": 0.13, "9": 0.14, "12": 0.17, "18": 0.20, "24": 0.24 },
                "bolkart": { "3": 0.09, "6": 0.13, "9": 0.14, "12": 0.17, "18": 0.20, "24": 0.24 }
            };
            const bankRates = {
                "resmi": { "2": 0.031, "3": 0.042, "6": 0.074, "12": 0.128, "18": 0.188, "24": 0.247, "35": 0.31 },
                "qeyri-resmi": { "2": 0.036, "3": 0.048, "6": 0.082, "12": 0.147, "18": 0.206, "24": 0.26, "35": 0.354 }
            };
            const abbRates = {
                "1": 0.05, "2": 0.07, "3": 0.08, "6": 0.11, "9": 0.16, "12": 0.18, "18": 0.26, "24": 0.35
            };

            if (seller === "abb") return abbRates[months] || 0;
            if (seller === "bank") return bankRates[bank]?.[months] || 0;
            return taksitRates[bank]?.[months] || 0;
        }

        function calculatePayment(section) {
            const s = section;
            const seller = document.getElementById(`seller${s}`).value;
            const bank = document.getElementById(`bank${s}`).value;
            const amountEl = document.getElementById(`amount${s}`);
            const initialEl = document.getElementById(`initialPayment${s}`);
            const monthsEl = document.getElementById(`months${s}`);

            const amount = parseFloat(amountEl.value) || 0;
            const initial = parseFloat(initialEl.value) || 0;
            const months = parseInt(monthsEl.value) || 0;

            const card = document.getElementById(`creditCard${s}`);
            const front = card.querySelector('.card-front');
            const back = card.querySelector('.card-back');
            const monthlyEl = document.getElementById(`cardMonthly${s}`);
            const interestEl = document.getElementById(`cardInterest${s}`);
            const totalEl = document.getElementById(`cardTotal${s}`);
            const bankNameEl = document.getElementById(`cardBankName${s}`);
            const planEl = document.getElementById(`paymentPlanContent${s}`);

            front.className = 'card-front';
            back.className = 'card-back';

            if (seller === "taksit") { front.classList.add('taksit'); back.classList.add('taksit'); }
            else if (seller === "bank") { front.classList.add('bank'); back.classList.add('bank'); }
            else if (seller === "abb") { front.classList.add('abb'); back.classList.add('abb'); }

            if (amount < 100 || amount > 10000 || initial > amount || months === 0 || isNaN(amount) || isNaN(initial)) {
                amountEl.classList.add('invalid-input');
                initialEl.classList.add('invalid-input');
                monthlyEl.innerText = "Xəta";
                interestEl.innerText = "Xəta";
                totalEl.innerText = "Xəta";
                planEl.innerHTML = "<p>Dəyərləri düzgün daxil edin</p>";
                const shareDiv = document.getElementById(`shareButtons${s}`);
                if (shareDiv) shareDiv.style.display = 'none';
                return;
            }

            amountEl.classList.remove('invalid-input');
            initialEl.classList.remove('invalid-input');

            const remaining = amount - initial;
            let serviceFee = (seller === "taksit" || seller === "abb") ? 20 : 0;
            const base = remaining + serviceFee;
            const rate = getInterestRate(bank, months, seller);
            const interest = base * rate;
            let total = base + interest;
            total = Math.round(total / 10) * 10;
            const monthly = total / months;

            bankNameEl.innerText = bankNames[bank] || bankNames[seller] || "Bank";
            monthlyEl.innerText = monthly.toFixed(2) + " AZN";
            interestEl.innerText = (rate * 100).toFixed(2) + "%";
            totalEl.innerText = total.toFixed(2) + " AZN";

            let html = `<table><tr><th>Ay</th><th>Ödəniş</th><th>Qalıq</th></tr>`;
            let rest = total;
            for (let i = 1; i <= months; i++) {
                rest -= monthly;
                html += `<tr><td>${i}</td><td>${monthly.toFixed(2)}</td><td>${Math.max(0, rest).toFixed(2)}</td></tr>`;
            }
            html += `</table>
                <div class="details">
                    <p>Məbləğ: ${amount.toFixed(2)} AZN</p>
                    <p>Xidmət haqqı: ${serviceFee.toFixed(2)} AZN</p>
                    <p>Faiz: ${(rate*100).toFixed(2)}%</p>
                </div>`;
            planEl.innerHTML = html;

            // Paylaş düymələrini göstər
            const shareDiv = document.getElementById(`shareButtons${s}`);
            if (shareDiv) {
                shareDiv.style.display = 'block';
            }
        }

        function getShareMessage(section) {
            const bank = document.getElementById(`cardBankName${section}`).innerText;
            const monthly = document.getElementById(`cardMonthly${section}`).innerText;
            const total = document.getElementById(`cardTotal${section}`).innerText;
            const months = document.getElementById(`months${section}`).value;

            return `Dəyərli müştəri,\n\n` +
                   `Məhsulun ümumi qiyməti: ${total}\n` +
                   `${months} aylıq taksit ilə\n` +
                   `Aylıq ödəniş: ${monthly}\n\n` +
                   `Hesablandı: ${bank}\n\n` +
                   `Təşəkkürlər! WTelecome`;
        }

        function shareToWhatsApp(section) {
            const message = getShareMessage(section);
            if (!message || message.includes("Xəta")) {
                alert("Əvvəlcə düzgün hesablama edin!");
                return;
            }
            const encoded = encodeURIComponent(message);
            window.open(`https://wa.me/?text=${encoded}`, '_blank');
        }

        function shareToInstagram(section) {
            const message = getShareMessage(section);
            if (!message || message.includes("Xəta")) {
                alert("Əvvəlcə düzgün hesablama edin!");
                return;
            }

            navigator.clipboard.writeText(message).then(() => {
                alert("Mesaj mətni kopyalandı!\n\nInstagram-ı açın və Story və ya Post-da yapışdırın.");

                // Instagram açmağa cəhd
                window.open("instagram://", "_blank");

                // Əgər Web Share API dəstəklənirsə
                if (navigator.share) {
                    navigator.share({
                        title: 'Kredit Hesablaması',
                        text: message
                    }).catch(() => {});
                }
            }).catch(() => {
                alert("Mətn kopyalanmadı. Əl ilə kopyalayın:\n\n" + message);
            });
        }

        function flipCard(section) {
            document.getElementById(`creditCard${section}`).classList.toggle('flipped');
        }

        function toggleSecondScenario() {
            const el = document.getElementById("secondScenario");
            const btn = document.getElementById("toggleScenarioBtn");
            if (el.style.display === "none") {
                el.style.display = "block";
                btn.innerText = "İkinci Ssenarini Bağla";
            } else {
                el.style.display = "none";
                btn.innerText = "İkinci Ssenarini Aktivləşdir";
            }
        }

        function compareBanks() {
            alert("Müqayisə funksiyası hələlik tam işləmir.");
        }

        function dualCompare() {
            calculatePayment('1');
            calculatePayment('2');
            if (document.getElementById("secondScenario").style.display === "none") {
                toggleSecondScenario();
            }
        }

        window.addEventListener('load', () => {
            const savedLang = localStorage.getItem('language') || 'az';
            document.getElementById('language').value = savedLang;
            updateLanguage();

            updateMonths('1');
            updateMonths('2');
            calculatePayment('1');
            calculatePayment('2');

            ['amount','initialPayment','seller','bank','months'].forEach(field => {
                ['1','2'].forEach(s => {
                    const el = document.getElementById(`${field}${s}`);
                    if (el) {
                        if (el.tagName === 'SELECT') {
                            el.addEventListener('change', () => {
                                if (field === 'seller') updateMonths(s);
                                calculatePayment(s);
                            });
                        } else {
                            el.addEventListener('input', () => calculatePayment(s));
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
